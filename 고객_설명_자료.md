# 💰 예수금 차이 관련 고객 안내문

## 📌 요약 (30초 설명용)

**"Available Cash가 키움증권 HTS와 다른 이유는 T+2 결제 규칙 때문입니다."**

- 한국투자증권 API는 **실제 출금 가능한 금액**만 표시 (엄격한 기준)
- 키움증권 HTS는 **참고용 예수금**도 함께 표시 (느슨한 기준)
- 매도 후 2영업일(T+2) 지나야 실제 사용 가능

---

## 🎯 고객별 맞춤 설명

### 📱 비전문가 고객용 (쉬운 설명)

**고객님, 간단히 말씀드리면:**

1. **한투 API**: "지금 당장 출금/매수 가능한 돈"만 표시
2. **키움 HTS**: "곧 들어올 돈"까지 합쳐서 표시

**예시로 설명드리면:**
```
월요일 - 주식을 $1,000에 팔았습니다
월요일 - 키움 HTS: "예수금 $1,000" 표시 ✅
월요일 - 한투 API: "Available Cash $0" 표시 ❌
         → 왜? 아직 정산이 안 끝났거든요!

수요일 - 정산 완료 (2영업일 후)
수요일 - 한투 API: "Available Cash $1,000" ✅
         → 이제 진짜 사용 가능!
```

**결론**: API가 더 엄격하게 관리하는 거라 안전합니다! 👍

---

### 💼 전문가/투자자 고객용 (정확한 설명)

**증권시장의 T+2 결제 규칙에 따른 정상적인 차이입니다.**

#### 1. API가 사용하는 필드
- **필드명**: `frcr_drwg_psbl_amt_1` (외화 인출가능금액)
- **의미**: T+2 결제가 완료된 금액만 포함
- **장점**: 실제 매수 가능한 금액이 정확함

#### 2. 키움증권 HTS와 차이 발생 원인

| 구분 | 한국투자증권 API | 키움증권 HTS |
|------|-----------------|-------------|
| 표시 기준 | 결제 완료분만 | 미결제 포함 가능 |
| 매도 후 반영 | T+2 후 반영 | 즉시 표시 (참고용) |
| 환율 | 실시간 | 고정 환율 가능 |
| 수수료 | 즉시 차감 | 일괄 정산 |

#### 3. 실제 사례

**현재 상태** (2025-10-22 기준):
```
Available Cash: $0.00
총 평가금액: $8,894.92
보유 종목: 3개 (INOD, PDYN, SES)

→ 모든 자금이 주식에 투자되어 있음
→ 매도 후 정산 대기 중인 금액 없음
```

**만약 최근 매도가 있었다면**:
```
10/20 (금) 15:50 - 주식 매도 $5,000
10/20 (금) 16:00 - 키움 HTS: 예수금 $5,000 표시
10/20 (금) 16:00 - 한투 API: Available Cash $0 (정산 대기)

10/22 (화) 09:30 - 정산 완료
10/22 (화) 09:30 - 한투 API: Available Cash $5,000 ✅
```

---

### 🏢 기업 고객용 (공식 설명)

**한국투자증권 OpenAPI의 예수금 조회 사양**

#### API 사양
- **TR ID**: TTTS3012R (실전) / VTTS3012R (모의)
- **응답 필드**: `output2[0].frcr_drwg_psbl_amt_1`
- **필드 설명**: 외화 인출가능금액 (T+2 결제 완료분)

#### 차이 발생 이유 (기술적 근거)

1. **결제 주기 차이**
   - 증권시장 표준: T+2 (거래일 +2 영업일)
   - API 반영: 결제 완료 후 즉시
   - HTS 표시: 거래 체결 즉시 (참고용)

2. **환율 적용 시점**
   - API: 실시간 고시 환율
   - HTS: 전일 종가 환율 또는 당일 오전 고시환율

3. **수수료 처리**
   - API: 거래 체결 시 즉시 차감
   - HTS: 일괄 정산 시 차감

#### 검증 방법
```bash
# API 원본 응답 확인
python debug_raw_balance.py

# 출력 예시:
# 외화인출가능금액1 (frcr_drwg_psbl_amt_1): 0.000000
```

#### 권장 사항
- **거래 시스템**: API 값 사용 (정확한 매수가능금액)
- **고객 안내**: HTS "D+2 예수금"과 비교 안내
- **정산 확인**: 매도 후 2영업일 경과 여부 확인

---

## 📞 FAQ (자주 묻는 질문)

### Q1. "왜 HTS는 $5,000인데 API는 $0인가요?"
**A**: 최근 2영업일 이내에 매도하신 거래가 있다면 정상입니다.
- HTS: 정산 예정 금액까지 표시 (참고용)
- API: 정산 완료된 금액만 표시 (실제 사용 가능)

### Q2. "언제 API에 반영되나요?"
**A**: 매도일 기준 2영업일(T+2) 후 반영됩니다.
- 월요일 매도 → 수요일 09:30 반영
- 금요일 매도 → 화요일 09:30 반영 (주말 제외)

### Q3. "자동매매에 문제 없나요?"
**A**: 전혀 없습니다. 오히려 더 안전합니다.
- API가 실제 매수 가능한 금액만 사용
- 과매수 방지 (available cash 범위 내에서만 매수)

### Q4. "HTS 예수금을 믿어야 하나요?"
**A**: 둘 다 맞습니다. 용도가 다를 뿐입니다.
- **HTS 예수금**: 참고용 (곧 들어올 돈 포함)
- **API Available Cash**: 실제 거래용 (지금 당장 사용 가능)
- **비교 기준**: HTS "D+2 예수금"과 API 비교하세요

### Q5. "차이를 없앨 수 있나요?"
**A**: 불가능합니다. 증권시장 규정(T+2)이기 때문입니다.
- 모든 증권사가 동일한 규칙 적용
- 고객 보호를 위한 제도적 장치

---

## ✅ 고객 확인 요청사항

고객님께서 직접 확인하실 수 있습니다:

### 방법 1: 한투 HTS/MTS 확인
1. 한국투자증권 HTS/MTS 접속
2. **해외주식 → 잔고** 메뉴
3. **"D+2 예수금"** 항목 확인
   - 이 값이 API의 Available Cash와 동일합니다

### 방법 2: 최근 거래 내역 확인
1. 최근 2영업일 이내 **매도 거래** 확인
2. 매도 금액 = (HTS 예수금 - API Available Cash)
3. 정산일 = 매도일 + 2영업일

---

## 🎁 고객 안심 포인트

1. ✅ **시스템이 정상 작동 중**입니다
2. ✅ **더 안전한 방식**으로 관리됩니다 (과매수 방지)
3. ✅ **증권시장 표준 규칙**을 따릅니다
4. ✅ **한투 공식 API** 그대로 사용 중입니다

---

## 📋 고객 응대 스크립트

### 패턴 1: 간단 설명 (30초)
```
"고객님, Available Cash는 '지금 당장 사용 가능한 돈'만 표시하는
엄격한 기준입니다. 키움 HTS는 '곧 들어올 돈'까지 포함해서 보여드리는
참고용 금액이라 차이가 날 수 있습니다. 매도하신 거래가 있으시면
2영업일 후에 API에도 반영됩니다."
```

### 패턴 2: 상세 설명 (1분)
```
"증권시장에는 T+2 결제 규칙이 있습니다. 주식을 팔면
실제 현금화까지 2영업일이 걸립니다.

- 한투 HTS: 매도 즉시 '예수금'으로 표시 (참고용)
- 한투 API: 2영업일 후 'Available Cash'로 반영 (실제 사용 가능)

이는 자동매매 시스템이 실제 사용 가능한 금액만 쓰도록
안전하게 관리하는 방식입니다.

HTS에서 'D+2 예수금' 항목을 확인하시면
API의 Available Cash와 동일한 금액을 보실 수 있습니다."
```

### 패턴 3: 기술 설명 (전문가용)
```
"한국투자증권 OpenAPI는 TTTS3012R 응답의
'frcr_drwg_psbl_amt_1' 필드를 사용합니다.
이는 T+2 결제가 완료된 금액만 포함하는 공식 필드입니다.

키움증권 HTS와의 차이는:
1. 결제 완료 여부 (T+2 규칙)
2. 환율 적용 시점 (실시간 vs 고정)
3. 수수료 차감 시점

이는 모든 증권사 API가 따르는 표준 규격으로,
시스템 안정성과 고객 보호를 위한 설계입니다."
```

---

## 📞 고객 지원 체크리스트

고객 문의 시 확인할 사항:

- [ ] 최근 2영업일 이내 매도 거래 여부
- [ ] 키움 HTS "D+2 예수금" 확인 요청
- [ ] 현재 보유 종목 및 평가금액 확인
- [ ] 미체결 주문 여부 확인
- [ ] 계좌 통화(USD) 확인

---

**작성일**: 2025-10-22
**버전**: v1.0
**담당**: 기술지원팀
