# 한국투자증권 자동매매 시스템

## 프로젝트 개요

한국투자증권 OpenAPI를 활용한 미국 주식 자동매매 시스템입니다. PJT #1 전략을 기반으로 실시간 시장 조건에 따라 자동으로 매수·매도를 실행합니다.

### 주요 특징

- **실시간 자동매매**: 상승 필터 조건 확인 후 하락률 기반 매수, 수익률 기반 매도
- **스케줄 기반 운영**: 매도 30분 주기, 매수 1시간 주기로 자동 실행
- **미체결 주문 관리**: 20분 내 미체결 시 자동 취소
- **안전한 운영**: 운영 시간 제한, 예외 상황 처리
- **확장 가능한 구조**: 향후 PJT #2 전략 추가 가능

### 운영 시간

- **매일 11:30 ~ 17:00** (미국 동부시간 기준)
- 주말 및 공휴일 자동 제외

## 시스템 구성

```
auto_trading_system/
├── main.py              # 메인 실행 스크립트
├── config.py            # 설정 파일
├── kis_api.py           # 한국투자증권 API 연동
├── strategy_pjt1.py     # PJT #1 매매 전략
├── order_manager.py     # 주문 관리 및 미체결 처리
├── watch_list.txt       # 관심종목 리스트
├── test_api.py          # API 연결 테스트
├── test_integration.py  # 통합 테스트
├── requirements.txt     # 의존성 패키지
└── README.md           # 사용 설명서
```

## 설치 및 설정

### 1. 의존성 패키지 설치

```bash
pip install -r requirements.txt
```

### 2. API 설정

`config.py` 파일에서 다음 항목을 설정하세요:

```python
# 한국투자증권 API 설정
KIS_APP_KEY = "your_app_key_here"
KIS_APP_SECRET = "your_app_secret_here"
KIS_ACCOUNT_NUMBER = "your_account_number_here"

# 모의투자 사용 여부
USE_PAPER_TRADING = True  # 실전투자시 False로 변경
```

### 3. 관심종목 설정

`watch_list.txt` 파일에 거래할 종목을 한 줄에 하나씩 입력하세요:

```
AAPL
GOOGL
TSLA
NVDA
AMZN
MSFT
META
NFLX
AMD
INTC
```

## 사용 방법

### 1. API 연결 테스트

```bash
python test_api.py
```

### 2. 통합 테스트

```bash
python test_integration.py
```

### 3. 시스템 실행

```bash
python main.py
```

### 4. 시스템 중지

실행 중인 터미널에서 `Ctrl+C`를 눌러 안전하게 중지할 수 있습니다.

## 전략 상세

### PJT #1 전략

#### 매수 조건 (1시간 주기)
1. **상승 필터 통과**: NVDA, AMZN, MSFT 모두 전일 대비 상승
2. **하락 종목 선정**: 관심종목 중 전일 대비 가장 많이 하락한 3개 종목
3. **가격 조건**: 매수 가격이 직전 매도가보다 낮을 때만 매수
4. **수량 계산**: 예수금의 1/3씩 분배하여 매수

#### 매도 조건 (30분 주기)
1. **고수익 매도**: 수익률 5% 이상 종목 즉시 매도
2. **일반 매도**: 그 외 수익률 가장 높은 종목 1개 매도
3. **가격 조건**: 현재가가 직전 매수가 이상일 때만 매도

#### 주문 관리
- **미체결 처리**: 매수 주문 후 20분 내 체결 안 되면 자동 취소
- **주문 방식**: 지정가 주문 (시장가 옵션 추후 추가 가능)
- **운영 시간 외**: 17:00 이후 신규 주문 금지, 기존 미체결 유지

## 설정 변경

### 전략 파라미터 수정

`config.py`에서 다음 값들을 조정할 수 있습니다:

```python
# 전략 설정
PROFIT_THRESHOLD = 0.05  # 매도 수익률 임계값 (5%)
ORDER_TIMEOUT_MINUTES = 20  # 미체결 주문 취소 시간 (분)

# 스케줄 설정
SELL_INTERVAL_MINUTES = 30  # 매도 체크 주기 (분)
BUY_INTERVAL_MINUTES = 60   # 매수 체크 주기 (분)

# 상승 필터 종목
FILTER_STOCKS = ["NVDA", "AMZN", "MSFT"]
```

### 관심종목 변경

`watch_list.txt` 파일을 수정하여 거래할 종목을 변경할 수 있습니다. 시스템 재시작 없이 실시간 반영됩니다.

## 로그 및 모니터링

### 로그 파일

- **파일 위치**: `trading.log`
- **로그 레벨**: INFO (config.py에서 변경 가능)
- **내용**: API 호출, 주문 실행, 전략 판단, 오류 등 모든 활동 기록

### 실시간 모니터링

시스템 실행 중 다음 정보가 주기적으로 출력됩니다:

- 현재 시간 및 거래 상태
- 미체결 주문 현황
- 전략 실행 결과
- 오류 및 예외 상황

## 안전 기능

### 1. 운영 시간 제한
- 미국 장 시간 외 자동 중단
- 주말 및 공휴일 거래 방지

### 2. 예외 상황 처리
- API 연결 실패 시 재시도 (최대 3회)
- 예수금 부족 시 해당 종목 스킵
- 가격 조회 실패 시 안전하게 건너뛰기

### 3. 주문 안전장치
- 미체결 주문 자동 취소
- 중복 매수 방지 로직
- 손실 매도 방지

## 문제 해결

### 자주 발생하는 문제

#### 1. API 연결 실패
```
해결방법:
1. config.py의 API 키 정보 확인
2. 한국투자증권 API 서비스 상태 확인
3. 네트워크 연결 상태 확인
```

#### 2. 토큰 만료 오류
```
해결방법:
- 시스템이 자동으로 토큰을 갱신하므로 대기
- 지속적인 문제 시 시스템 재시작
```

#### 3. 주문 실패
```
해결방법:
1. 계좌 잔고 확인
2. 종목 거래 가능 여부 확인
3. 시장 개장 시간 확인
```

### 로그 확인

문제 발생 시 `trading.log` 파일을 확인하여 상세한 오류 정보를 확인할 수 있습니다.

## 확장 계획

### PJT #2 전략 (향후 추가 예정)
- 고가/저가 중간값 기반 진입 전략
- 상위 25%/하위 25% 구간 판단 로직
- 기존 시스템과 호환되는 모듈형 구조

### 추가 기능 (2차 개발)
- 텔레그램 알림 연동
- GUI 대시보드
- 다계좌 지원
- CSV/DB 거래 이력 저장
- 백테스팅 기능

## 지원 및 문의

### 무료 지원 범위
- 단순 전략 수정 1회 (조건 숫자 변경 등)
- 설정 관련 문의
- 기본 사용법 안내

### 추가 개발 문의
- 새로운 전략 추가
- 고급 기능 구현
- 커스터마이징 요청

## 라이선스

이 소프트웨어는 개인 사용 목적으로 제공됩니다. 상업적 사용이나 재배포 시 별도 협의가 필요합니다.

## 면책 조항

- 이 시스템은 투자 참고용으로 제공되며, 투자 손실에 대한 책임을 지지 않습니다.
- 실전 투자 전 충분한 테스트와 검증을 권장합니다.
- 시장 상황에 따라 예상과 다른 결과가 발생할 수 있습니다.

